var t,e={};function s(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,i)}return s}function i(t){for(var e,i=1;i<arguments.length;i++)e=null==arguments[i]?{}:arguments[i],i%2?s(Object(e),!0).forEach(function(s){var i;i=e[s],s in t?Object.defineProperty(t,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[s]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):s(Object(e)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(e,s))});return t}const o={threshold:50,passive:!1};e=class{constructor(t,e={}){this.options=i(i({},o),e),this.element=null,this.touchStartX=0,this.touchStartY=0,this.touchEndX=0,this.touchEndY=0,this.onSwipeLeftAgent=null,this.onSwipeRightAgent=null,this.onSwipeUpAgent=null,this.onSwipeDownAgent=null,this.onTapAgent=null,this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onSwipeLeft=this.onSwipeLeft.bind(this),this.onSwipeRight=this.onSwipeRight.bind(this),this.onSwipeUp=this.onSwipeUp.bind(this),this.onSwipeDown=this.onSwipeDown.bind(this),this.onTap=this.onTap.bind(this),this.destroy=this.destroy.bind(this),this.handleGesture=this.handleGesture.bind(this);let s=!!this.options.passive&&{passive:!0};this.element=t instanceof EventTarget?t:document.querySelector(t),this.element.addEventListener("touchstart",this.onTouchStart,s),this.element.addEventListener("touchend",this.onTouchEnd,s)}onTouchStart(t){this.touchStartX=t.changedTouches[0].screenX,this.touchStartY=t.changedTouches[0].screenY}onTouchEnd(t){this.touchEndX=t.changedTouches[0].screenX,this.touchEndY=t.changedTouches[0].screenY,this.handleGesture()}onSwipeLeft(t){this.onSwipeLeftAgent=t}onSwipeRight(t){this.onSwipeRightAgent=t}onSwipeUp(t){this.onSwipeUpAgent=t}onSwipeDown(t){this.onSwipeDownAgent=t}onTap(t){this.onTapAgent=t}destroy(){this.element.removeEventListener("touchstart",this.onTouchStart),this.element.removeEventListener("touchend",this.onTouchEnd)}handleGesture(){return this.touchEndX+this.options.threshold<=this.touchStartX?(this.onSwipeLeftAgent&&this.onSwipeLeftAgent(),"swiped left"):this.touchEndX-this.options.threshold>=this.touchStartX?(this.onSwipeRightAgent&&this.onSwipeRightAgent(),"swiped right"):this.touchEndY+this.options.threshold<=this.touchStartY?(this.onSwipeUpAgent&&this.onSwipeUpAgent(),"swiped up"):this.touchEndY-this.options.threshold>=this.touchStartY?(this.onSwipeDownAgent&&this.onSwipeDownAgent(),"swiped down"):this.touchEndY===this.touchStartY?(this.onTapAgent&&this.onTapAgent(),"tap"):void 0}};const n=()=>10*Math.random()>3?2:4,h=new class{constructor(t){t?(this.state=t,this.startState=t):(this.state=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.startState=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]),this.status="idle",this.score=0}moveLeft(){let t=[[],[],[],[]],e=[[],[],[],[]];if("playing"===this.getStatus()){for(let s=0;s<4;s++)for(let i=0;i<4;i++)t[s][i]=this.getState()[s][i],e[s][i]=this.getState()[s][i];let s=t=>{for(let e=0;e<4;e++)for(let e=0;e<3;e++)0===t[e]&&(t[e]=t[e+1],t[e+1]=0)};for(let t=0;t<4;t++){let i=e[t];s(i);for(let t=0;t<3;t++)i[t]===i[t+1]&&(i[t]=2*i[t],i[t+1]=0,this.setScore(i[t]));s(i),e[t]=i}JSON.stringify(this.getState())!==JSON.stringify(e)&&this.createNewCell(e),this.checkLose(),this.checkWin()}}moveRight(){let t=[[],[],[],[]],e=[[],[],[],[]];if("playing"===this.getStatus()){for(let s=0;s<4;s++)for(let i=0;i<4;i++)t[s][i]=this.getState()[s][i],e[s][i]=this.getState()[s][i];let s=t=>{for(let e=3;e>=0;e--)for(let e=3;e>0;e--)0===t[e]&&(t[e]=t[e-1],t[e-1]=0)};for(let t=0;t<4;t++){let i=e[t];s(i);for(let t=3;t>=0;t--)i[t]===i[t-1]&&(i[t]=2*i[t],i[t-1]=0,this.setScore(i[t]));s(i),e[t]=i}JSON.stringify(this.getState())!==JSON.stringify(e)&&this.createNewCell(e),this.checkLose(),this.checkWin()}}moveUp(){let t=[[],[],[],[]];function e(t){for(let e=0;e<4;e++)for(let e=0;e<3;e++)0===t[e]&&(t[e]=t[e+1],t[e+1]=0)}if("playing"===this.getStatus()){for(let e=0;e<4;e++)for(let s=0;s<4;s++)t[e][s]=this.getState()[e][s];for(let s=0;s<4;s++){let i=[];for(let e=0;e<4;e++)i[e]=t[e][s];e(i);for(let t=0;t<3;t++)i[t]===i[t+1]&&(i[t]=2*i[t],i[t+1]=0,this.setScore(i[t]));e(i);for(let e=0;e<4;e++)t[e][s]=i[e]}JSON.stringify(this.getState())!==JSON.stringify(t)&&this.createNewCell(t),this.checkLose(),this.checkWin()}}moveDown(){let t=[[],[],[],[]];function e(t){for(let e=3;e>=0;e--)for(let e=3;e>0;e--)0===t[e]&&(t[e]=t[e-1],t[e-1]=0)}if("playing"===this.getStatus()){for(let e=0;e<4;e++)for(let s=0;s<4;s++)t[e][s]=this.getState()[e][s];for(let s=0;s<4;s++){let i=[];for(let e=0;e<4;e++)i[e]=t[e][s];e(i);for(let t=0;t<3;t++)i[t]===i[t+1]&&(i[t]=2*i[t],i[t+1]=0,this.setScore(i[t]));e(i);for(let e=0;e<4;e++)t[e][s]=i[e]}JSON.stringify(this.getState())!==JSON.stringify(t)&&this.createNewCell(t),this.checkLose(),this.checkWin()}}checkWin(){for(let t=0;t<4;t++)for(let e=0;e<4;e++)2048===this.getState()[t][e]&&this.setStatus("win")}checkLose(){let t=0,e=16;for(let t=0;t<4;t++)for(let s=0;s<4;s++)0!==this.getState()[t][s]&&e--;for(let e=0;e<4;e++)for(let s=0;s<3;s++)this.getState()[e][s]!==this.getState()[e][s+1]&&t++;for(let e=0;e<4;e++)for(let s=0;s<3;s++)this.getState()[s][e]!==this.getState()[s+1][e]&&t++;24===t&&0===e&&this.setStatus("lose")}getScore(){return this.score}setScore(t){this.score=this.getScore()+t}resetScore(){this.score=0}getState(){return this.state}setState(t){this.state=t}getStatus(){return this.status}setStatus(t){this.status=t}start(){this.setStatus("playing"),this.makeNewField()}restart(){this.setStatus("idle"),this.setState(this.startState),this.resetScore()}makeNewField(){let t=n(),e=n(),s=this.startState.map(t=>t.slice()).flat(1),i=[];for(let t=0;t<s.length;t++)0===s[t]&&i.push(t);if(0===i.length)return;let o=Math.round(Math.random()*(i.length-1)),h=Math.round(Math.random()*(i.length-1));for(;o===h;)h=Math.round(Math.random()*i.length);s[i[o]]=t,s[i[h]]=e;let r=0,a=this.startState.map(t=>t.slice());for(let t=0;t<4;t++)for(let e=0;e<4;e++)a[t][e]=s[r],r++;this.setState(a)}createNewCell(t){let e=n(),s=t.map(t=>t.slice()).flat(1),i=[];for(let t=0;t<s.length;t++)0===s[t]&&i.push(t);if(0===i.length)return;let o=Math.round(Math.random()*(i.length-1));s[i[o]]=e;let h=0,r=t.map(t=>t.slice());for(let t=0;t<4;t++)for(let e=0;e<4;e++)r[t][e]=s[h],h++;this.setState(r)}},r=document.querySelector(".game-score"),a=document.querySelector("button"),c=document.querySelector(".message-start"),l=document.querySelector(".message-win"),d=document.querySelector(".message-lose");function u(){let t=document.querySelectorAll("td"),e=h.getState().map(t=>t.slice()).flat(1);t[0].setAttribute("class","");try{for(let s=0;s<16;s++)t[s].setAttribute("class",""),t[s].textContent="",0===e[s]?t[s].classList.add("field-cell"):(t[s].classList.add("field-cell"),t[s].classList.add(`field-cell--${e[s]}`),t[s].textContent=e[s])}catch{}r.textContent=h.getScore(),function(){switch(h.getStatus()){case"idle":c.classList.remove("hidden"),l.classList.add("hidden"),d.classList.add("hidden");break;case"playing":c.classList.add("hidden"),l.classList.add("hidden"),d.classList.add("hidden");break;case"win":c.classList.add("hidden"),l.classList.remove("hidden"),d.classList.add("hidden");break;case"lose":c.classList.add("hidden"),l.classList.add("hidden"),d.classList.remove("hidden")}}()}u(),function t(){a.addEventListener("click",()=>{a.classList.remove("start"),a.classList.add("restart"),h.start(),u(),a.addEventListener("click",()=>{a.classList.add("start"),a.classList.remove("restart"),h.restart(),u(),t()})})}(),document.querySelector("html").addEventListener("keydown",t=>{switch(t.key){case"ArrowUp":h.moveUp();break;case"ArrowDown":h.moveDown();break;case"ArrowLeft":h.moveLeft();break;case"ArrowRight":h.moveRight()}u()}),document.querySelector(".move-up").addEventListener("click",()=>{h.moveUp(),u()}),document.querySelector(".move-down").addEventListener("click",()=>{h.moveDown(),u()}),document.querySelector(".move-left").addEventListener("click",()=>{h.moveLeft(),u()}),document.querySelector(".move-right").addEventListener("click",()=>{h.moveRight(),u()});const S=document.querySelector("html"),g=new((t=e)&&t.__esModule?t.default:t)(S);g.onSwipeUp(()=>{h.moveUp(),u()}),g.onSwipeDown(()=>{h.moveDown(),u()}),g.onSwipeLeft(()=>{h.moveLeft(),u()}),g.onSwipeRight(()=>{h.moveRight(),u()});
//# sourceMappingURL=index.2a59689e.js.map
